<html>
    <head>
        <title>WebGL - Canvas test</title>
        <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />

        <script type="text/javascript" src="script/glMatrix.js"></script>
        <script type="text/javascript" src="script/callbacks.js"></script>
        <script type="text/javascript" src="script/glCourseBasis.js"></script>
        <script type="text/javascript" src="script/objLoader.js"></script>
        <script type="text/javascript" src="script/cubeMap.js"></script>
        <script type="text/javascript" src="script/plane.js"></script>
        <script type="text/javascript" src="script/objMesh.js"></script>
        <script type="text/javascript" src="script/light.js"></script>

        <link rel="stylesheet" type="text/css" href="css/style.css" />
    
    </head>

    <body onload="webGLStart();">
        <div class="main">
            <div class="content-wrapper">
                <canvas class="canvas" id="WebGL-test"></canvas>
            </div>
            <nav class="vertical-menu-wrapper">
                <div class="vertical-menu-logo">
                    <span class="open-menu-btn"
                        ><hr />
                        <hr />
                        <hr
                    /></span>
                </div>
                <ul class="vertical-menu">
                    <div class="settings">
                        <p style="text-align: center; color: white">Joue avec moi !</p>
                        <div class="setting-select-cubeMap" id="val">
                            <label for="select-cubeMap" style="margin-left: 10px;">CubeMap</label>
                            <select id="select-cubeMap" onchange="setImageTextCubeMap(this.value)">
                                <option value="0" selected>Chateau</option>
                                <option value="1">Space</option>
                                <option value="2">Plage</option>
                            </select>
                        </div>
                        <div class="setting-select-objet" id="val">
                            <label for="select-obj" style="margin-left: 10px;">Objet</label>
                            <select id="select-obj" onchange="setObj(this.value)">
                                <option value="0" selected>Bunny</option>
                                <option value="1">Sphere</option>
                                <option value="2">Porsche</option>
                                <option value="3">Mustang</option>
                                <option value="4" >cube</option>
                            </select>
                        </div>

                        <div class="setting-slider" id="val">
                            <div class="setting-check-mirroir" id="val">
                                <label for="mirroir">Miroir</label>
                                <input type="checkbox" id="mirroir" onchange="setIsMirroir(this.checked)"/>
                            </div>
                            <div class="setting-check-cooker" id="val">
                                <label for="cooker">cooker</label>
                                <input type="checkbox" id="cooker" onchange="setIsCooker(this.checked)"/>
                            </div>
                            <div class="setting-check-echantionnage" id="val">
                                <label for="transparence">Echantionnage</label>
                                <input type="checkbox" id="echantionnage" onchange="setIsEchantionnage(this.checked)" checked/>
                            </div>
                            <div class="setting-check-transparence" id="val">
                                <label for="transparence">Transparence</label>
                                <input type="checkbox" id="transparence" onchange="setIsTransparence(this.checked)" />
                            </div>
                            <label for="indices" id="val">Indices de r√©fraction</label>
                            <input type="range" class="indices" style="margin-left: 10px;" name="indices" id="myRange" value="1.3" min="1.0" max="3.0" step="0.1" oninput="handleNi(this.value)" />
                            <input type="number" value="1.3" min="1.0" max="3.0"  style="margin-left: 10px;" id="myInput" step="0.1" onchange="handleNi(this.value)" />

                            <label for="indices" id="val">Sigma</label>
                            <input type="range" class="indices" style="margin-left: 10px;" name="indices" id="rangeSigma" value="0.01" min="0.0" max="0.5" step="0.01" oninput="handleSigma(this.value)" />
                            <input type="number" value="1.3" min="1.0" max="3.0"  style="margin-left: 10px;" id="inputSigma" step="0.1" onchange="handleSigma(this.value)" />
                            
                            <label for="indices" id="val">Echantionnage</label>
                            <input type="range" class="indices" style="margin-left: 10px;" name="indices" id="rangeEchantionnage" value="0.0" min="0.0" max="1000.0" step="1.0" oninput="handleEchantionnage(this.value)" />
                            <input type="number" value="0.0" min="0.0" max="1000.0"  style="margin-left: 10px;" id="inputEchantionnage" step="1.0" onchange="handleEchantionnage(this.value)" />

                            <br /> <br /><label for="colorpicker" style="margin-left: 10px;">Choisie ta couleur </label>
                            <input type="color" id="colorpicker" value="#ffffff" oninput="handleColor(event)" />
                            <input type="color" id="colorpicker" value="#ffffff" oninput="handleLightColor(event)" />
                        </div>
                </ul>
            </nav>
        </div>
    </body>

    <script>
                    var sliderEchantionnage = document.getElementById("rangeEchantionnage");
                    var inputEchantionnage = document.getElementById("inputEchantionnage");
                    var sliderSigma = document.getElementById("rangeSigma");
                    var inputSigma = document.getElementById("inputSigma");
                    var slider = document.getElementById("myRange");
                    var input = document.getElementById("myInput");

                    const handleEchantionnage = (value) => {
                        setIterationEchantionnage(value);
                        sliderEchantionnage.value = value;
                        inputEchantionnage.value = value;
                    }

                    const handleNi = (value) => {
                        setNi(value);
                        slider.value = value;
                        input.value = value;
                    };

                    const handleSigma = (value) => {
                        setSigma(value);
                        sliderSigma.value=value;
                        inputSigma.value=value;
                    }

                    const hexToRgb = (hex) =>
                        hex
                            .replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i, (m, r, g, b) => "#" + r + r + g + g + b + b)
                            .substring(1)
                            .match(/.{2}/g)
                            .map((x) => parseInt(x, 16));

                    function handleColor(ev) {
                        const color = ev.target.value;
                        colors = hexToRgb(color);
                        colors = colors.map((element) => (element = element / 255));
                    }

                    function handleLightColor(ev) {
                        const color = ev.target.value;
                        LIGHT.color = hexToRgb(color);
                        LIGHT.color = LIGHT.color.map((element) => (element = element / 255));
                    }

                    // parametre par default
                    handleNi(1.5);
                    handleSigma(0.1);
                    setIsEchantionnage(true);
                    handleEchantionnage(90.0);
                    //-------------------------
                    document.querySelector(".open-menu-btn").addEventListener("click", function () {
                    if (document.querySelector("body").classList.contains("closed-menu")) {
                        document.querySelector("body").classList.remove("closed-menu");
                    } else document.querySelector("body").classList.add("closed-menu");
                });
    </script>
</html>
