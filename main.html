<html>
    <head>
        <title>WebGL - Canvas test</title>
        <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1" />

        <script type="text/javascript" src="script/glMatrix.js"></script>
        <script type="text/javascript" src="script/callbacks.js"></script>
        <script type="text/javascript" src="script/glCourseBasis.js"></script>
        <script type="text/javascript" src="script/objLoader.js"></script>
        <script type="text/javascript" src="script/cubeMap.js"></script>
        <script type="text/javascript" src="script/plane.js"></script>
        <script type="text/javascript" src="script/objMesh.js"></script>
        <script type="text/javascript" src="script/light.js"></script>

        <link rel="stylesheet" type="text/css" href="css/style.css" />
    
    </head>

    <body onload="webGLStart();">
        <div class="main">
            <div class="content-wrapper">
                <canvas class="canvas" id="WebGL-test"></canvas>
            </div>
            <nav class="vertical-menu-wrapper">
                <div class="vertical-menu-logo">
                    <span class="open-menu-btn"
                        ><hr />
                        <hr />
                        <hr
                    /></span>
                </div>
                <ul class="vertical-menu">
                    <div class="settings">
                        <p style="text-align: center; color: white">Joue avec moi !</p>
                        <div class="setting-select-cubeMap" id="val">
                            <label for="select-cubeMap" style="margin-left: 10px;">CubeMap</label>
                            <select id="select-cubeMap" onchange="setImageTextCubeMap(this.value)">
                                <option value="0" selected>Chateau</option>
                                <option value="1">Space</option>
                                <option value="2">Plage</option>
                            </select>
                        </div>
                        <div class="setting-select-objet" id="val">
                            <label for="select-obj" style="margin-left: 10px;">Objet</label>
                            <select id="select-obj" onchange="setObj(this.value)">
                                <option value="0" selected>Bunny</option>
                                <option value="1">Sphere</option>
                                <option value="2">Porsche</option>
                                <option value="3">Mustang</option>
                                <option value="4">cube</option>
                            </select>
                        </div>

                        <div class="setting-color" id="val">
                            <label for="colorpicker" style="margin-left: 10px;">Couleur de l'objet</label>
                            <input type="color" id="colorpicker" value="#ffffff" oninput="handleColor(event)" />
                            <br /> <br />
                            <label for="colorpicker" style="margin-left: 10px;">Couleur lumière</label>
                            <input type="color" style="margin-left: 16px;"  id="colorpicker" value="#ffffff" oninput="handleLightColor(event)" />
                        </div>


                        <div class="setting-select-objet" id="val">
                            <label for="select-obj" style="margin-left: 10px;">Propriétés</label>
                            <select id="select-obj" style="margin-top: 10px;" onchange="handleChanceProps(this.value)">
                                <option value=0>Miroir</option>
                                <option value=1>Miroir avec transparence</option>
                                <option value=2>Cook et torrance</option>
                                <option value=3>Transparence</option>
                                <option value=4>Miroir dépoli</option>
                                <option value=5 selected>Echantillonnage d'importance </option>
                            </select>
                        </div>

                        <div class="setting-slider" id="val">
                            <div>
                                <label for="indices" id="val">Indices de réfraction</label>
                                <input type="range" class="indices" style="margin-left: 10px;" name="indices" id="rangeNi" value="1.3" min="1.0" max="3.0" step="0.1" oninput="handleNi(this.value)" />
                                <input type="number" value="1.3" min="1.0" max="50" style="margin-left: 10px;" id="inputNi" step="0.1" onchange="handleNi(this.value)" />
                            </div>
                            <br/>
                            <div>
                                <label for="indices" id="val">Sigma</label> </br>
                                <input type="range" class="indices" style="margin-left: 10px;" name="indices" id="rangeSigma" value="0.0001" min="0.0001" max="0.5" step="0.0001" oninput="handleSigma(this.value)" />
                                <input type="number" value="1.3" min="1.0" max="50" style="margin-left: 10px;" id="inputSigma" step="0.1" onchange="handleSigma(this.value)" />
                            </div>
                            <br/>
                            <div>
                                <label for="indices" id="val">Intesité lumineuse</label> </br>
                                <input type="range" class="indices" style="margin-left: 10px;" name="indices" id="rangeIntensite" value="1" min="0.5" max="10" step="0.1" oninput="handleIntensiteLumineuse(this.value)" />
                                <input type="number" value="1" min="0.5" max="10" style="margin-left: 10px;" id="inputIntensite" step="0.1" onchange="handleIntensiteLumineuse(this.value)" />
                            </div>
                            <div>
                                <label for="indices" id="val">nombre échantion</label> </br>
                                <input type="range" class="indices" style="margin-left: 10px;" name="indices" id="rangeNbEchantion" value="1" min="1" max="100" step="1" oninput="handleNbEchantion(this.value)" />
                                <input type="number" value="1" min="1" max="100" style="margin-left: 10px;" id="inputNbEchantion" step="1" onchange="handleNbEchantion(this.value)" />
                            </div>
                        </div>
                    </div>
                </ul>
            </nav>
        </div>
    </body>

    <script>
        var sliderNi = document.getElementById("rangeNi");
        var inputNi = document.getElementById("inputNi");
        var sliderSigma = document.getElementById("rangeSigma");
        var inputSigma = document.getElementById("inputSigma");
        var sliderIntensite = document.getElementById("rangeIntensite");
        var inputIntensite = document.getElementById("inputIntensite");
        var sliderNbEchantion = document.getElementById("rangeNbEchantion");
        var inputNbEchantion = document.getElementById("inputNbEchantion");
        

        const handleNi = (value) => {
            setNi(value);
            sliderNi.value = value;
            inputNi.value = value;
        };

        const handleSigma = (value) => {
            setSigma(value);
            sliderSigma.value=value;
            inputSigma.value=value;
        }

        const handleIntensiteLumineuse = (value) => {
            setIntensiteLumineuse(value);
            sliderIntensite.value = value;
            inputIntensite.value = value;
        }

        const handleNbEchantion = (value) => {
            setNbEchantion(value);
            sliderNbEchantion.value = value;
            inputNbEchantion.value = value;
        }


        const handleChanceProps = (value) =>{
            switch(value){
                case "0":
                    setIsMirroir(true)
                    setIsTransparence(false)
                    setIsCooker(false)
                    setIsEchantion(false)
                    setIsMiroirDePoli(false)
                    break;
                case "1":
                    setIsMirroir(true)
                    setIsTransparence(true)
                    setIsCooker(false)
                    setIsEchantion(false)
                    setIsMiroirDePoli(false)
                    break;
                case "2":
                    setIsMirroir(false)
                    setIsTransparence(false)
                    setIsCooker(true)
                    setIsEchantion(false)
                    setIsMiroirDePoli(false)
                    break;
                case "3":
                    setIsMirroir(false)
                    setIsTransparence(true)
                    setIsCooker(false)
                    setIsEchantion(false)
                    setIsMiroirDePoli(false)
                    break;
                case "4":
                    setIsMirroir(false)
                    setIsTransparence(false)
                    setIsCooker(false)
                    setIsEchantion(true)
                    setIsMiroirDePoli(true)
                    break;
                case "5":
                    setIsMirroir(false)
                    setIsTransparence(false)
                    setIsCooker(false)
                    setIsEchantion(true)
                    setIsMiroirDePoli(false)
                    break;
                
                default: 
                    setIsMirroir(false)
                    setIsTransparence(false)
                    setIsCooker(false)
                    setIsEchantion(true)
                    setIsMiroirDePoli(false)
            }
        }


        const hexToRgb = (hex) =>
            hex
                .replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i, (m, r, g, b) => "#" + r + r + g + g + b + b)
                .substring(1)
                .match(/.{2}/g)
                .map((x) => parseInt(x, 16));

        function handleColor(ev) {
            const color = ev.target.value;
            colors = hexToRgb(color);
            colors = colors.map((element) => (element = element / 255));
            console.log(colors)
        }

        function handleLightColor(ev) {
            const color = ev.target.value;
            LIGHT.color = hexToRgb(color);
            LIGHT.color = LIGHT.color.map((element) => (element = element / 255));
            console.log(LIGHT.color)
        }

        // valeur par defaut
        handleNi(1.5);
        handleSigma(0.0001);
        handleIntensiteLumineuse(1.0);
        setNbEchantion(1);
        setIsEchantion(true);
        document.querySelector(".open-menu-btn").addEventListener("click", function () {
        if (document.querySelector("body").classList.contains("closed-menu")) {
            document.querySelector("body").classList.remove("closed-menu");
        } else document.querySelector("body").classList.add("closed-menu");
    });
    </script>
</html>
